<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Askverse</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-icon">A</div>
            <span>Askverse</span>
        </div>
        
        <nav class="nav-menu">
            <a href="dashboard.html" class="nav-item active">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                </svg>
                <span>Home</span>
            </a>
            
            <a href="#" class="nav-item" id="sidebar-search-btn">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <span>Search</span>
            </a>
            
            <a href="#" class="nav-item" id="sidebar-messages-btn">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                </svg>
                <span>Messages</span>
            </a>
            
            <a href="leaderboard.html" class="nav-item">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                </svg>
                <span>Leaderboard</span>
            </a>
            
            <a href="#" class="nav-item" id="sidebar-notifications-btn">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                </svg>
                <span>Notifications</span>
            </a>
            
            <a href="ask-question.html" class="nav-item">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                <span>Ask Question</span>
            </a>
            
            <a href="profile.html" class="nav-item">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <span>Profile</span>
            </a>
        </nav>
        
        <div class="nav-profile">
            <div class="profile-info" id="profile-info-sidebar">
                <div class="avatar" id="user-avatar-sidebar">U</div>
                <div class="profile-text">
                    <h4 id="profile-name-sidebar">User</h4>
                    <!-- UPDATED: Enhanced credits display -->
                    <div class="credits-badge" style="margin-top: 4px;">
                        <svg class="credits-icon" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                        </svg>
                        <span id="profile-credits-sidebar">100</span>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Top Header -->
            <header class="top-header">
                <div class="search-container">
                    <div class="search-bar">
                        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input type="text" placeholder="Search questions..." class="search-input" id="search-input">
                    </div>
                </div>
                
                <div class="header-actions">
                    <button class="icon-btn" id="notifications-btn">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="22" height="22">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                        <span class="notification-badge">3</span>
                    </button>
                    
                    <button class="btn btn-primary" onclick="window.location.href='ask-question.html'">
                        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Ask Question
                    </button>
                </div>
            </header>

            <!-- Create Post Card -->
            <div class="create-post-card">
                <div class="create-post-content">
                    <div class="avatar" id="create-avatar">U</div>
                    <button class="create-post-input" onclick="window.location.href='ask-question.html'">
                        What's your question?
                    </button>
                </div>
            </div>

            <!-- Feed -->
            <div id="feed">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Sidebar Widget -->
    <aside class="sidebar-right">
        <!-- NEW: Enhanced Credits Widget -->
        <div class="credits-widget">
            <div class="credits-widget-content">
                <div class="credits-title">üí∞ Your Credits</div>
                <div class="credits-amount" id="sidebar-credits-display">100</div>
                <div class="credits-label">Total Earned</div>
                
                <div style="display: flex; gap: 12px; margin-top: 20px; justify-content: center;">
                    <div style="text-align: center;">
                        <div style="font-size: 18px; font-weight: 700; color: var(--success);">+10</div>
                        <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Today</div>
                    </div>
                    <div style="width: 1px; background: var(--border);"></div>
                    <div style="text-align: center;">
                        <div style="font-size: 18px; font-weight: 700; color: var(--primary);">+50</div>
                        <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">This Week</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                    <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 12px; font-weight: 600;">üìä How to Earn More</div>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 13px;">
                            <span style="color: var(--text);">‚úÖ Answer accepted</span>
                            <span class="credits-badge" style="font-size: 11px; padding: 4px 10px;">+25</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 13px;">
                            <span style="color: var(--text);">üëç Answer upvoted</span>
                            <span class="credits-badge" style="font-size: 11px; padding: 4px 10px;">+10</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 13px;">
                            <span style="color: var(--text);">‚ùì Ask question</span>
                            <span class="credits-badge" style="font-size: 11px; padding: 4px 10px;">+5</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="widget">
            <h3 class="widget-title">Top Experts</h3>
            <div class="expert-list" id="expert-list">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <div class="widget" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1)); border-color: rgba(59, 130, 246, 0.3);">
            <h3 class="widget-title">üéØ Daily Challenge</h3>
            <p style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px;">Answer 3 questions today and earn bonus credits!</p>
            <div style="background: var(--card); border-radius: 8px; padding: 8px; margin-bottom: 12px;">
                <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">
                    <span>Progress</span>
                    <span>0/3</span>
                </div>
                <div style="height: 6px; background: var(--border); border-radius: 3px; overflow: hidden;">
                    <div style="height: 100%; width: 0%; background: linear-gradient(90deg, var(--primary), var(--accent));"></div>
                </div>
            </div>
            <button class="btn btn-primary btn-small" style="width: 100%;" onclick="showNotification('Daily challenge feature coming soon! üéØ', 'info')">Start Challenge</button>
        </div>
    </aside>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } 
               from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, collection, query, orderBy, limit, getDocs, doc, getDoc } 
               from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
        import { firebaseConfig } from "./js/firebaseConfig.js";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let userData = null;

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = 'index.html';
            } else {
                currentUser = user;
                await loadUserData();
                await loadFeed();
                await loadTopExperts();
            }
        });

        async function loadUserData() {
            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                
                if (userDoc.exists()) {
                    userData = userDoc.data();
                } else {
                    userData = {
                        email: currentUser.email,
                        fullName: currentUser.displayName || currentUser.email.split('@')[0],
                        username: currentUser.email.split('@')[0],
                        credits: 100
                    };
                }

                const initials = userData.fullName 
                    ? userData.fullName.substring(0, 2).toUpperCase()
                    : currentUser.email.substring(0, 2).toUpperCase();
                
                document.getElementById('user-avatar-sidebar').textContent = initials;
                document.getElementById('create-avatar').textContent = initials;
                document.getElementById('profile-name-sidebar').textContent = userData.fullName || userData.username;
                document.getElementById('profile-credits-sidebar').textContent = `${userData.credits || 100}`;
                
                // NEW: Update sidebar credits display
                document.getElementById('sidebar-credits-display').textContent = userData.credits || 100;

            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Rest of your existing JavaScript code continues...
        // (loadFeed, loadTopExperts, etc.)
        
        window.showNotification = function(message, type = 'success') {
            const notification = document.createElement('div');
            const icons = {
                success: '‚úì',
                error: '‚úï',
                info: '‚Ñπ'
            };
            const icon = icons[type] || icons.info;
            
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span style="font-size: 18px; font-weight: bold;">${icon}</span>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>

    <!-- NEW: Dark Mode Toggle Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.createElement('button');
            themeToggle.className = 'theme-toggle';
            themeToggle.setAttribute('aria-label', 'Toggle dark mode');
            themeToggle.innerHTML = `
                <svg class="sun-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                </svg>
                <svg class="moon-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                </svg>
            `;
            
            document.body.appendChild(themeToggle);
            
            const currentTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            
            themeToggle.addEventListener('click', function() {
                const theme = document.documentElement.getAttribute('data-theme');
                const newTheme = theme === 'light' ? 'dark' : 'light';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                themeToggle.style.transform = 'rotate(360deg)';
                setTimeout(() => {
                    themeToggle.style.transform = '';
                }, 300);
            });
        });
    </script>
</body>
</html>